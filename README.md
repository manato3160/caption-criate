# キャプション生成ツール

Instagram投稿用キャプション生成ツールのフロントエンドアプリケーションです。LangGenius/DifyのワークフローAPIをバックエンドとして使用し、トワニーブランドに合わせた優雅で上品なUIを提供します。

## 機能

- **新規キャプション生成**: 企画情報と参照データを入力してキャプションを生成
- **キャプション修正**: 既存キャプションに対する修正指示を送信
- **ファイルアップロード**: 参照資料のアップロード（画像・ドキュメント、最大5ファイル）
- **URL参照**: 最大3つの参照URLを入力
- **リアルタイム表示**: 生成されたキャプションの即座な表示
- **AI薬機審査**: OpenAI APIを使用した自動薬機法審査機能（NG表現の自動検出とハイライト表示）

## 技術スタック

- **フロントエンド**: Next.js 14 (App Router), React, TypeScript
- **スタイリング**: Tailwind CSS
- **API連携**: LangGenius/Dify API

## セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

### 2. 環境変数の設定

プロジェクトルートに `.env.local` ファイルを作成し、以下の環境変数を設定してください：

```env
# Dify API設定
NEXT_PUBLIC_DIFY_API_ENDPOINT=https://dify.aibase.buzz/v1
NEXT_PUBLIC_DIFY_API_KEY=your-api-key-here

# OpenAI API設定（薬機審査機能用）
OPENAI_API_KEY=your-openai-api-key-here
```

**注意**: 
- チャットアプリ（advanced-chatモード）の場合、APP_IDは不要です。APIキーにアプリ情報が含まれています。
- OpenAI APIキーはサーバーサイドでのみ使用されます（環境変数に`NEXT_PUBLIC_`プレフィックスを付けないでください）。

### 3. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで [http://localhost:3000](http://localhost:3000) を開いてアプリケーションを確認できます。

## 使用方法

### 新規キャプション生成

1. 「新規作成」タブを選択
2. 必須項目を入力：
   - **企画案**: キャプションのテーマやタイトル（最大256文字）
   - **企画意図**: 企画の詳細な意図や背景（最大10000文字）
3. 任意項目を入力：
   - **参照URL①〜③**: 商品ページや参考サイトのURL
   - **参照資料**: 画像やPDFファイル（最大5ファイル、各15MBまで）
4. 「キャプションを生成」ボタンをクリック

### キャプション修正

1. まず新規作成でキャプションを生成
2. 「修正」タブを選択
3. 修正指示を入力（例: 「冒頭部分をもっと親しみやすい表現に変更してください」）
4. 「修正を適用」ボタンをクリック

## プロジェクト構造

```
/
├── app/
│   ├── layout.tsx            # ルートレイアウト
│   ├── page.tsx              # メインページ
│   └── globals.css           # グローバルスタイル
├── components/
│   ├── CaptionForm.tsx       # 入力フォームコンポーネント
│   ├── CaptionDisplay.tsx    # キャプション表示コンポーネント
│   ├── FileUpload.tsx        # ファイルアップロードコンポーネント
│   └── LoadingSpinner.tsx    # ローディング表示
├── lib/
│   ├── api.ts                # Dify APIクライアント
│   └── types.ts              # TypeScript型定義
└── README.md
```

## ビルド

本番環境用のビルド：

```bash
npm run build
```

ビルドされたアプリケーションの起動：

```bash
npm start
```

## 注意事項

- Dify APIの認証方式に合わせた実装が必要です
- ファイルアップロードはDify APIの仕様に従います
- 会話変数（current_caption）の管理が必要です
- 質問分類器による新規作成/修正の自動判定に対応しています

## ライセンス

このプロジェクトはプライベートプロジェクトです。

